<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Femi-PeriodTracker</title>

<style>
body {
  color: #4a004a;
  min-height: 100vh;
  background-image: url("static/images/bbk.jpg");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
}

.navbar {
  width: 100%;
  background-color: #ff71a3;
  color: white;
  padding: 15px 20px;
  font-size: 24px;
  font-weight: bold;
}

.container { display: flex; min-height: calc(100vh - 60px); }

.sidebar {
  width: 250px;
  padding: 20px;
  background: #fdd9e7;
}

.sidebar label { display: block; margin: 15px 0; }

.main {
  flex: 1;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.month-navigation {
  margin-bottom: 10px;
  display: flex;
  gap: 10px;
  align-items: center;
}

button {
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  color: white;
}

.prev, .cancel { background-color: #aaa; }
.next, .save, .edit { background-color: #d6336c; }

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 50px);
  gap: 8px;
}

.day {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: 2px solid #000000;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  font-weight: bold;
}

.day.today { border-color: #d6336c; }
.day.period { background-color: #ff99c2; color: white; border: none; }
.day.saved-period { background-color: #d6336c; color: white; border: none; cursor: default; }
.day.ovulation { border: 3px solid #d6336c; }

.weekdays {
  display: grid;
  grid-template-columns: repeat(7, 50px);
  margin-bottom: 5px;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="navbar">Femi-PeriodTracker</div>

<div class="container">

<div class="sidebar">
<h2>Settings</h2>

<label>Period Length (days):
<input type="number" id="period-length" value="5" min="1" max="10">
</label>

<label>Cycle Length (days):
<input type="number" id="cycle-length" value="28" min="20" max="40">
</label>

<div>
ðŸ©· Ovulation Date: <span id="ovulation-date">-</span><br>
ðŸ©· Next Period Date: <span id="next-period-date">-</span>
</div>
</div>

<div class="main">

<div class="month-navigation">
<button class="prev" onclick="changeMonth(-1)">Previous</button>
<h2 id="month-year"></h2>
<button class="next" onclick="changeMonth(1)">Next</button>
</div>

<div class="weekdays" id="weekdays"></div>
<div class="calendar" id="calendar"></div>

<div style="margin-top:20px;">
<button class="cancel" id="cancelBtn" onclick="resetCalendar()">Cancel</button>
<button class="save" id="saveBtn" onclick="saveCalendar()">Save</button>
<button class="edit" id="editBtn" onclick="editCalendar()" style="display:none;">Edit</button>
</div>

</div>
</div>

<script>
const saveBtn = document.getElementById("saveBtn");
const cancelBtn = document.getElementById("cancelBtn");
const editBtn = document.getElementById("editBtn");
const periodInput = document.getElementById('period-length');
const cycleInput = document.getElementById('cycle-length');
const ovulationDisplay = document.getElementById('ovulation-date');
const nextPeriodDisplay = document.getElementById('next-period-date');
const calendarEl = document.getElementById('calendar');
const monthYearEl = document.getElementById('month-year');
const weekdaysEl = document.getElementById('weekdays');

let today = new Date();
let currentMonth = today.getMonth();
let currentYear = today.getFullYear();
let selectedStartDate = null;

function renderWeekdays() {
weekdaysEl.innerHTML = '';
['S','M','T','W','T','F','S'].forEach(day=>{
let d=document.createElement('div');
d.style.textAlign='center';
d.textContent=day;
weekdaysEl.appendChild(d);
});
}

function generateCalendar(month=currentMonth,year=currentYear){
calendarEl.innerHTML='';
monthYearEl.textContent=new Date(year,month)
.toLocaleString('default',{month:'long',year:'numeric'});

let firstDay=new Date(year,month,1).getDay();
let daysInMonth=new Date(year,month+1,0).getDate();

for(let i=0;i<firstDay;i++){
let emptyCell=document.createElement('div');
emptyCell.classList.add('day');
emptyCell.style.visibility="hidden";
calendarEl.appendChild(emptyCell);
}

for(let day=1;day<=daysInMonth;day++){
let cell=document.createElement('div');
cell.classList.add('day');

let dateObj=new Date(year,month,day);
cell.dataset.date=dateObj.toISOString();
cell.textContent=day;

if(dateObj.toDateString()===today.toDateString())
cell.classList.add('today');

cell.addEventListener('click',()=>selectPeriod(dateObj));
calendarEl.appendChild(cell);
}
}

function selectPeriod(startDate){
selectedStartDate=startDate;

document.querySelectorAll('.day')
.forEach(el=>el.classList.remove('period','saved-period','ovulation'));

let periodLength=parseInt(periodInput.value);
let cycleLength=parseInt(cycleInput.value);

for(let i=0;i<periodLength;i++){
let d=new Date(startDate);
d.setDate(d.getDate()+i);
highlightDate(d,'period');
}

let nextPeriod=new Date(startDate);
nextPeriod.setDate(nextPeriod.getDate()+cycleLength);

let ovulation=new Date(nextPeriod);
ovulation.setDate(ovulation.getDate()-14);

highlightDate(ovulation,'ovulation');

ovulationDisplay.textContent=ovulation.toDateString();
nextPeriodDisplay.textContent=nextPeriod.toDateString();
}

function highlightDate(date,className){
document.querySelectorAll('.day').forEach(cell=>{
if(new Date(cell.dataset.date).toDateString()===date.toDateString())
cell.classList.add(className);
});
}

function saveCalendar(){
if(!selectedStartDate){
alert("Select period first!");
return;
}

fetch('/save_period',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
last_period:selectedStartDate.toISOString().split('T')[0],
cycle_length:parseInt(cycleInput.value),
period_length:parseInt(periodInput.value)
})
})
.then(res=>res.json())
.then(data=>{
document.querySelectorAll('.day.period')
.forEach(el=>{
el.classList.remove('period');
el.classList.add('saved-period');
});

saveBtn.style.display="none";
cancelBtn.style.display="none";
editBtn.style.display="inline-block";

alert("Saved successfully!");
});
}

function editCalendar(){
saveBtn.style.display="inline-block";
cancelBtn.style.display="inline-block";
editBtn.style.display="none";

document.querySelectorAll('.day.saved-period')
.forEach(el=>{
el.classList.remove('saved-period');
el.classList.add('period');
});
}

function resetCalendar(){
selectedStartDate=null;
document.querySelectorAll('.day')
.forEach(el=>el.classList.remove('period','saved-period','ovulation'));
ovulationDisplay.textContent='-';
nextPeriodDisplay.textContent='-';
}

function loadSavedPeriod(){
fetch('/get_period')
.then(res=>res.json())
.then(data=>{
if(!data.last_period) return;

periodInput.value=data.period_length;
cycleInput.value=data.cycle_length;

let startDate=new Date(data.last_period);
selectedStartDate=startDate;

let periodLength=parseInt(data.period_length);
let cycleLength=parseInt(data.cycle_length);

for(let i=0;i<periodLength;i++){
let d=new Date(startDate);
d.setDate(d.getDate()+i);
highlightDate(d,'saved-period');
}

let nextPeriod=new Date(startDate);
nextPeriod.setDate(nextPeriod.getDate()+cycleLength);

let ovulation=new Date(nextPeriod);
ovulation.setDate(ovulation.getDate()-14);

highlightDate(ovulation,'ovulation');

ovulationDisplay.textContent=ovulation.toDateString();
nextPeriodDisplay.textContent=nextPeriod.toDateString();

saveBtn.style.display="none";
cancelBtn.style.display="none";
editBtn.style.display="inline-block";
});
}

function changeMonth(offset){
currentMonth+=offset;
if(currentMonth>11){currentMonth=0;currentYear++;}
if(currentMonth<0){currentMonth=11;currentYear--;}
generateCalendar();
loadSavedPeriod();
}

document.addEventListener("DOMContentLoaded",function(){
renderWeekdays();
generateCalendar();
loadSavedPeriod();
});
</script>

</body>
</html>